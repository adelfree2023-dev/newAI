FAIL src/security/layers/s4-audit-logging/audit.service.spec.ts (12.298 s)
  AuditService
    Ã— logs activities (17 ms)
    Ã— logs security events (3 ms)
    Ã— falls back to console when system is not ready (3 ms)
    Ã— falls back to local file on database error (S4) (1 ms)
    Ã— handles missing audit table schema gracefully (2 ms)
    Ã— logs operations using logOperation (2 ms)
    Ã— throws InternalServerErrorException on getAuditLogs failure (3 ms)
    Ã— logs activity using object argument (2 ms)
    Ã— handles mkdirSync error in logToFallback (2 ms)

  â— AuditService â€º logs activities

    Nest can't resolve dependencies of the AuditService (REQUEST, ?, PrismaService). Please make sure that the argument TenantContextService at index [1] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If TenantContextService is a provider, is it part of the current RootTestModule?
    - If TenantContextService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing TenantContextService */ ]
      })

    [0m [90m 12 |[39m     mockPrisma[33m.[39m$queryRaw[33m.[39mmockResolvedValue([{ exists[33m:[39m [36mtrue[39m }])[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m     [36mconst[39m module[33m:[39m [33mTestingModule[39m [33m=[39m [36mawait[39m [33mTest[39m[33m.[39mcreateTestingModule({
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 15 |[39m       providers[33m:[39m [
     [90m 16 |[39m         [33mAuditService[39m[33m,[39m
     [90m 17 |[39m         [33m...[39mgetCommonProviders([[33mAuditService[39m])[33m,[39m[0m

      at TestingInjector.lookupComponentInParentModules (../../../node_modules/@nestjs/core/injector/injector.js:262:19)
      at TestingInjector.resolveComponentInstance (../../../node_modules/@nestjs/core/injector/injector.js:215:33)
      at TestingInjector.resolveComponentInstance (../../../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../../../node_modules/@nestjs/core/injector/injector.js:129:38)
          at async Promise.all (index 1)
      at TestingInjector.resolveConstructorParams (../../../node_modules/@nestjs/core/injector/injector.js:144:27)
      at TestingInjector.loadInstance (../../../node_modules/@nestjs/core/injector/injector.js:70:13)
      at TestingInjector.loadProvider (../../../node_modules/@nestjs/core/injector/injector.js:98:9)
      at ../../../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../../../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../../../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../../../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../../../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../../../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../../../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../../../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (security/layers/s4-audit-logging/audit.service.spec.ts:14:35)

  â— AuditService â€º logs security events

    Nest can't resolve dependencies of the AuditService (REQUEST, ?, PrismaService). Please make sure that the argument TenantContextService at index [1] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If TenantContextService is a provider, is it part of the current RootTestModule?
    - If TenantContextService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing TenantContextService */ ]
      })

    [0m [90m 12 |[39m     mockPrisma[33m.[39m$queryRaw[33m.[39mmockResolvedValue([{ exists[33m:[39m [36mtrue[39m }])[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m     [36mconst[39m module[33m:[39m [33mTestingModule[39m [33m=[39m [36mawait[39m [33mTest[39m[33m.[39mcreateTestingModule({
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 15 |[39m       providers[33m:[39m [
     [90m 16 |[39m         [33mAuditService[39m[33m,[39m
     [90m 17 |[39m         [33m...[39mgetCommonProviders([[33mAuditService[39m])[33m,[39m[0m

      at TestingInjector.lookupComponentInParentModules (../../../node_modules/@nestjs/core/injector/injector.js:262:19)
      at TestingInjector.resolveComponentInstance (../../../node_modules/@nestjs/core/injector/injector.js:215:33)
      at TestingInjector.resolveComponentInstance (../../../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../../../node_modules/@nestjs/core/injector/injector.js:129:38)
          at async Promise.all (index 1)
      at TestingInjector.resolveConstructorParams (../../../node_modules/@nestjs/core/injector/injector.js:144:27)
      at TestingInjector.loadInstance (../../../node_modules/@nestjs/core/injector/injector.js:70:13)
      at TestingInjector.loadProvider (../../../node_modules/@nestjs/core/injector/injector.js:98:9)
      at ../../../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../../../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../../../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../../../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../../../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../../../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../../../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../../../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (security/layers/s4-audit-logging/audit.service.spec.ts:14:35)

  â— AuditService â€º falls back to console when system is not ready

    Nest can't resolve dependencies of the AuditService (REQUEST, ?, PrismaService). Please make sure that the argument TenantContextService at index [1] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If TenantContextService is a provider, is it part of the current RootTestModule?
    - If TenantContextService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing TenantContextService */ ]
      })

    [0m [90m 12 |[39m     mockPrisma[33m.[39m$queryRaw[33m.[39mmockResolvedValue([{ exists[33m:[39m [36mtrue[39m }])[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m     [36mconst[39m module[33m:[39m [33mTestingModule[39m [33m=[39m [36mawait[39m [33mTest[39m[33m.[39mcreateTestingModule({
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 15 |[39m       providers[33m:[39m [
     [90m 16 |[39m         [33mAuditService[39m[33m,[39m
     [90m 17 |[39m         [33m...[39mgetCommonProviders([[33mAuditService[39m])[33m,[39m[0m

      at TestingInjector.lookupComponentInParentModules (../../../node_modules/@nestjs/core/injector/injector.js:262:19)
      at TestingInjector.resolveComponentInstance (../../../node_modules/@nestjs/core/injector/injector.js:215:33)
      at TestingInjector.resolveComponentInstance (../../../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../../../node_modules/@nestjs/core/injector/injector.js:129:38)
          at async Promise.all (index 1)
      at TestingInjector.resolveConstructorParams (../../../node_modules/@nestjs/core/injector/injector.js:144:27)
      at TestingInjector.loadInstance (../../../node_modules/@nestjs/core/injector/injector.js:70:13)
      at TestingInjector.loadProvider (../../../node_modules/@nestjs/core/injector/injector.js:98:9)
      at ../../../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../../../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../../../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../../../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../../../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../../../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../../../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../../../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (security/layers/s4-audit-logging/audit.service.spec.ts:14:35)

  â— AuditService â€º falls back to local file on database error (S4)

    Nest can't resolve dependencies of the AuditService (REQUEST, ?, PrismaService). Please make sure that the argument TenantContextService at index [1] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If TenantContextService is a provider, is it part of the current RootTestModule?
    - If TenantContextService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing TenantContextService */ ]
      })

    [0m [90m 12 |[39m     mockPrisma[33m.[39m$queryRaw[33m.[39mmockResolvedValue([{ exists[33m:[39m [36mtrue[39m }])[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m     [36mconst[39m module[33m:[39m [33mTestingModule[39m [33m=[39m [36mawait[39m [33mTest[39m[33m.[39mcreateTestingModule({
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 15 |[39m       providers[33m:[39m [
     [90m 16 |[39m         [33mAuditService[39m[33m,[39m
     [90m 17 |[39m         [33m...[39mgetCommonProviders([[33mAuditService[39m])[33m,[39m[0m

      at TestingInjector.lookupComponentInParentModules (../../../node_modules/@nestjs/core/injector/injector.js:262:19)
      at TestingInjector.resolveComponentInstance (../../../node_modules/@nestjs/core/injector/injector.js:215:33)
      at TestingInjector.resolveComponentInstance (../../../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../../../node_modules/@nestjs/core/injector/injector.js:129:38)
          at async Promise.all (index 1)
      at TestingInjector.resolveConstructorParams (../../../node_modules/@nestjs/core/injector/injector.js:144:27)
      at TestingInjector.loadInstance (../../../node_modules/@nestjs/core/injector/injector.js:70:13)
      at TestingInjector.loadProvider (../../../node_modules/@nestjs/core/injector/injector.js:98:9)
      at ../../../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../../../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../../../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../../../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../../../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../../../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../../../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../../../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (security/layers/s4-audit-logging/audit.service.spec.ts:14:35)

  â— AuditService â€º handles missing audit table schema gracefully

    Nest can't resolve dependencies of the AuditService (REQUEST, ?, PrismaService). Please make sure that the argument TenantContextService at index [1] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If TenantContextService is a provider, is it part of the current RootTestModule?
    - If TenantContextService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing TenantContextService */ ]
      })

    [0m [90m 12 |[39m     mockPrisma[33m.[39m$queryRaw[33m.[39mmockResolvedValue([{ exists[33m:[39m [36mtrue[39m }])[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m     [36mconst[39m module[33m:[39m [33mTestingModule[39m [33m=[39m [36mawait[39m [33mTest[39m[33m.[39mcreateTestingModule({
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 15 |[39m       providers[33m:[39m [
     [90m 16 |[39m         [33mAuditService[39m[33m,[39m
     [90m 17 |[39m         [33m...[39mgetCommonProviders([[33mAuditService[39m])[33m,[39m[0m

      at TestingInjector.lookupComponentInParentModules (../../../node_modules/@nestjs/core/injector/injector.js:262:19)
      at TestingInjector.resolveComponentInstance (../../../node_modules/@nestjs/core/injector/injector.js:215:33)
      at TestingInjector.resolveComponentInstance (../../../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../../../node_modules/@nestjs/core/injector/injector.js:129:38)
          at async Promise.all (index 1)
      at TestingInjector.resolveConstructorParams (../../../node_modules/@nestjs/core/injector/injector.js:144:27)
      at TestingInjector.loadInstance (../../../node_modules/@nestjs/core/injector/injector.js:70:13)
      at TestingInjector.loadProvider (../../../node_modules/@nestjs/core/injector/injector.js:98:9)
      at ../../../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../../../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../../../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../../../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../../../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../../../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../../../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../../../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (security/layers/s4-audit-logging/audit.service.spec.ts:14:35)

  â— AuditService â€º logs operations using logOperation

    Nest can't resolve dependencies of the AuditService (REQUEST, ?, PrismaService). Please make sure that the argument TenantContextService at index [1] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If TenantContextService is a provider, is it part of the current RootTestModule?
    - If TenantContextService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing TenantContextService */ ]
      })

    [0m [90m 12 |[39m     mockPrisma[33m.[39m$queryRaw[33m.[39mmockResolvedValue([{ exists[33m:[39m [36mtrue[39m }])[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m     [36mconst[39m module[33m:[39m [33mTestingModule[39m [33m=[39m [36mawait[39m [33mTest[39m[33m.[39mcreateTestingModule({
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 15 |[39m       providers[33m:[39m [
     [90m 16 |[39m         [33mAuditService[39m[33m,[39m
     [90m 17 |[39m         [33m...[39mgetCommonProviders([[33mAuditService[39m])[33m,[39m[0m

      at TestingInjector.lookupComponentInParentModules (../../../node_modules/@nestjs/core/injector/injector.js:262:19)
      at TestingInjector.resolveComponentInstance (../../../node_modules/@nestjs/core/injector/injector.js:215:33)
      at TestingInjector.resolveComponentInstance (../../../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../../../node_modules/@nestjs/core/injector/injector.js:129:38)
          at async Promise.all (index 1)
      at TestingInjector.resolveConstructorParams (../../../node_modules/@nestjs/core/injector/injector.js:144:27)
      at TestingInjector.loadInstance (../../../node_modules/@nestjs/core/injector/injector.js:70:13)
      at TestingInjector.loadProvider (../../../node_modules/@nestjs/core/injector/injector.js:98:9)
      at ../../../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../../../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../../../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../../../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../../../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../../../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../../../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../../../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (security/layers/s4-audit-logging/audit.service.spec.ts:14:35)

  â— AuditService â€º throws InternalServerErrorException on getAuditLogs failure

    Nest can't resolve dependencies of the AuditService (REQUEST, ?, PrismaService). Please make sure that the argument TenantContextService at index [1] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If TenantContextService is a provider, is it part of the current RootTestModule?
    - If TenantContextService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing TenantContextService */ ]
      })

    [0m [90m 12 |[39m     mockPrisma[33m.[39m$queryRaw[33m.[39mmockResolvedValue([{ exists[33m:[39m [36mtrue[39m }])[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m     [36mconst[39m module[33m:[39m [33mTestingModule[39m [33m=[39m [36mawait[39m [33mTest[39m[33m.[39mcreateTestingModule({
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 15 |[39m       providers[33m:[39m [
     [90m 16 |[39m         [33mAuditService[39m[33m,[39m
     [90m 17 |[39m         [33m...[39mgetCommonProviders([[33mAuditService[39m])[33m,[39m[0m

      at TestingInjector.lookupComponentInParentModules (../../../node_modules/@nestjs/core/injector/injector.js:262:19)
      at TestingInjector.resolveComponentInstance (../../../node_modules/@nestjs/core/injector/injector.js:215:33)
      at TestingInjector.resolveComponentInstance (../../../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../../../node_modules/@nestjs/core/injector/injector.js:129:38)
          at async Promise.all (index 1)
      at TestingInjector.resolveConstructorParams (../../../node_modules/@nestjs/core/injector/injector.js:144:27)
      at TestingInjector.loadInstance (../../../node_modules/@nestjs/core/injector/injector.js:70:13)
      at TestingInjector.loadProvider (../../../node_modules/@nestjs/core/injector/injector.js:98:9)
      at ../../../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../../../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../../../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../../../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../../../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../../../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../../../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../../../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (security/layers/s4-audit-logging/audit.service.spec.ts:14:35)

  â— AuditService â€º logs activity using object argument

    Nest can't resolve dependencies of the AuditService (REQUEST, ?, PrismaService). Please make sure that the argument TenantContextService at index [1] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If TenantContextService is a provider, is it part of the current RootTestModule?
    - If TenantContextService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing TenantContextService */ ]
      })

    [0m [90m 12 |[39m     mockPrisma[33m.[39m$queryRaw[33m.[39mmockResolvedValue([{ exists[33m:[39m [36mtrue[39m }])[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m     [36mconst[39m module[33m:[39m [33mTestingModule[39m [33m=[39m [36mawait[39m [33mTest[39m[33m.[39mcreateTestingModule({
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 15 |[39m       providers[33m:[39m [
     [90m 16 |[39m         [33mAuditService[39m[33m,[39m
     [90m 17 |[39m         [33m...[39mgetCommonProviders([[33mAuditService[39m])[33m,[39m[0m

      at TestingInjector.lookupComponentInParentModules (../../../node_modules/@nestjs/core/injector/injector.js:262:19)
      at TestingInjector.resolveComponentInstance (../../../node_modules/@nestjs/core/injector/injector.js:215:33)
      at TestingInjector.resolveComponentInstance (../../../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../../../node_modules/@nestjs/core/injector/injector.js:129:38)
          at async Promise.all (index 1)
      at TestingInjector.resolveConstructorParams (../../../node_modules/@nestjs/core/injector/injector.js:144:27)
      at TestingInjector.loadInstance (../../../node_modules/@nestjs/core/injector/injector.js:70:13)
      at TestingInjector.loadProvider (../../../node_modules/@nestjs/core/injector/injector.js:98:9)
      at ../../../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../../../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../../../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../../../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../../../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../../../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../../../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../../../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (security/layers/s4-audit-logging/audit.service.spec.ts:14:35)

  â— AuditService â€º handles mkdirSync error in logToFallback

    Nest can't resolve dependencies of the AuditService (REQUEST, ?, PrismaService). Please make sure that the argument TenantContextService at index [1] is available in the RootTestModule context.

    Potential solutions:
    - Is RootTestModule a valid NestJS module?
    - If TenantContextService is a provider, is it part of the current RootTestModule?
    - If TenantContextService is exported from a separate @Module, is that module imported within RootTestModule?
      @Module({
        imports: [ /* the Module containing TenantContextService */ ]
      })

    [0m [90m 12 |[39m     mockPrisma[33m.[39m$queryRaw[33m.[39mmockResolvedValue([{ exists[33m:[39m [36mtrue[39m }])[33m;[39m
     [90m 13 |[39m
    [31m[1m>[22m[39m[90m 14 |[39m     [36mconst[39m module[33m:[39m [33mTestingModule[39m [33m=[39m [36mawait[39m [33mTest[39m[33m.[39mcreateTestingModule({
     [90m    |[39m                                   [31m[1m^[22m[39m
     [90m 15 |[39m       providers[33m:[39m [
     [90m 16 |[39m         [33mAuditService[39m[33m,[39m
     [90m 17 |[39m         [33m...[39mgetCommonProviders([[33mAuditService[39m])[33m,[39m[0m

      at TestingInjector.lookupComponentInParentModules (../../../node_modules/@nestjs/core/injector/injector.js:262:19)
      at TestingInjector.resolveComponentInstance (../../../node_modules/@nestjs/core/injector/injector.js:215:33)
      at TestingInjector.resolveComponentInstance (../../../node_modules/@nestjs/testing/testing-injector.js:19:45)
      at resolveParam (../../../node_modules/@nestjs/core/injector/injector.js:129:38)
          at async Promise.all (index 1)
      at TestingInjector.resolveConstructorParams (../../../node_modules/@nestjs/core/injector/injector.js:144:27)
      at TestingInjector.loadInstance (../../../node_modules/@nestjs/core/injector/injector.js:70:13)
      at TestingInjector.loadProvider (../../../node_modules/@nestjs/core/injector/injector.js:98:9)
      at ../../../node_modules/@nestjs/core/injector/instance-loader.js:56:13
          at async Promise.all (index 3)
      at TestingInstanceLoader.createInstancesOfProviders (../../../node_modules/@nestjs/core/injector/instance-loader.js:55:9)
      at ../../../node_modules/@nestjs/core/injector/instance-loader.js:40:13
          at async Promise.all (index 1)
      at TestingInstanceLoader.createInstances (../../../node_modules/@nestjs/core/injector/instance-loader.js:39:9)
      at TestingInstanceLoader.createInstancesOfDependencies (../../../node_modules/@nestjs/core/injector/instance-loader.js:22:13)
      at TestingInstanceLoader.createInstancesOfDependencies (../../../node_modules/@nestjs/testing/testing-instance-loader.js:9:9)
      at TestingModuleBuilder.createInstancesOfDependencies (../../../node_modules/@nestjs/testing/testing-module.builder.js:118:9)
      at TestingModuleBuilder.compile (../../../node_modules/@nestjs/testing/testing-module.builder.js:74:9)
      at Object.<anonymous> (security/layers/s4-audit-logging/audit.service.spec.ts:14:35)

Test Suites: 1 failed, 1 total
Tests:       9 failed, 9 total
Snapshots:   0 total
Time:        13.117 s, estimated 21 s
Ran all test suites matching /packages\\core\\src\\security\\layers\\s4-audit-logging\\audit.service.spec.ts/i.
